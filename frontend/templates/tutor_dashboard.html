{% extends "base.html" %}
{% block title %}Tutor Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Tutor Dashboard</h2>

    {% with messages = get_flashed_messages(request) %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{{ message.category }} alert-dismissible fade show" role="alert">
                    {{ message.message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}


    <hr>
    <h3 class="mt-4">‚úÖ My Assigned Tuitions</h3>
    {% if assigned_leads %}
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Area</th>
                    <th>Board</th>
                    <th>Subjects</th>
                    <th>Fee</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in assigned_leads %}
                <tr>
                    <td>{{ lead.full_name }}</td>
                    <td>{{ lead.area }}</td>
                    <td>{{ lead.board }}</td>
                    <td>{{ lead.subjects }}</td>
                    <td>Rs. {{ lead.total_fee }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>You have no assigned tuitions yet.</p>
    {% endif %}

    <hr>
    <h3 class="mt-5">‚è≥ My Pending Requests</h3>
    {% if pending_leads %}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Area</th>
                    <th>Board</th>
                    <th>Fee</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in pending_leads %}
                <tr>
                    <td>{{ lead.full_name }}</td>
                    <td>{{ lead.area }}</td>
                    <td>{{ lead.board }}</td>
                    <td>Rs. {{ lead.total_fee }}</td>
                    <td><span class="badge bg-warning text-dark">Pending Admin Approval</span></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>You have no pending requests.</p>
    {% endif %}

    <hr>
    <h3 class="mt-5">üì¢ Available Student Leads</h3>
    <form method="get" action="{{ url_for('tutor_dashboard') }}" class="mb-4 p-3 bg-light border rounded">
        <div class="row g-2 align-items-end">
            <div class="col-md-3">
                <label for="area" class="form-label">Area:</label>
                <select name="area" id="area" class="form-select">
                    <option value="">--Select Area--</option>
                    <option value="DHA" {% if selected_area == 'DHA' %}selected{% endif %}>DHA</option>
                    <option value="GULSHAN-E-IQBAL" {% if selected_area == 'GULSHAN-E-IQBAL' %}selected{% endif %}>GULSHAN-E-IQBAL</option>
                    <option value="PECHS" {% if selected_area == 'PECHS' %}selected{% endif %}>PECHS</option>
                    <option value="Gulistan-e-Johar" {% if selected_area == 'Gulistan-e-Johar' %}selected{% endif %}>Gulistan-e-Johar</option>
                    <option value="Gulberg" {% if selected_area == 'Gulberg' %}selected{% endif %}>Gulberg</option>
                    <option value="North Nazimabad" {% if selected_area == 'North Nazimabad' %}selected{% endif %}>North Nazimabad</option>
                    <option value="North Karachi" {% if selected_area == 'North Karachi' %}selected{% endif %}>North Karachi</option>
                    <option value="Saddar" {% if selected_area == 'Saddar' %}selected{% endif %}>Saddar</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="board" class="form-label">Board:</label>
                <select name="board" id="board" class="form-select">
                    <option value="">--Select Board--</option>
                    <option value="Cambridge O'Levels" {% if selected_board == "Cambridge O'Levels" %}selected{% endif %}>Cambridge O'Levels</option>
                    <option value="Cambridge A'Levels" {% if selected_board == "Cambridge A'Levels" %}selected{% endif %}>Cambridge A'Levels</option>
                    <option value="Karachi Matric Board" {% if selected_board == "Karachi Matric Board" %}selected{% endif %}>Karachi Matric Board</option>
                    <option value="Karachi Inter board" {% if selected_board == "Karachi Inter board" %}selected{% endif %}>Karachi Inter board</option>
                    <option value="Fedral Board" {% if selected_board == "Fedral Board" %}selected{% endif %}>Fedral Board</option>
                    <option value="Aga Khan Board" {% if selected_board == "Aga Khan Board" %}selected{% endif %}>Aga Khan Board</option>
                    <option value="ICAP" {% if selected_board == "ICAP" %}selected{% endif %}>ICAP</option>
                    <option value="ACCA" {% if selected_board == "ACCA" %}selected{% endif %}>ACCA</option>
                    <option value="ICMA" {% if selected_board == "ICMA" %}selected{% endif %}>ICMA</option>
                    <option value="Sindh Technical Board" {% if selected_board == "Sindh Technical Board" %}selected{% endif %}>Sindh Technical Board</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="subject" class="form-label">Subject:</label>
                 <input type="text" name="subject" id="subject" class="form-control" value="{{ selected_subject or '' }}" placeholder="e.g., Physics or Mathematics">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
            </div>
        </div>
    </form>

    {% if available_leads %}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Area</th>
                    <th>Board</th>
                    <th>Subjects</th>
                    <th>Fee</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                {% for lead in available_leads %}
                <tr>
                    <td>{{ lead.full_name }}</td>
                    <td>{{ lead.area }}</td>
                    <td>{{ lead.board }}</td>
                    <td>{{ lead.subjects }}</td>
                    <td>Rs. {{ lead.total_fee }}</td>
                    <td>
                        <form class="accept-lead-form" method="POST" action="{{ url_for('accept_lead', lead_id=lead.id) }}">
                            <button type="submit" class="btn btn-success accept-lead-btn">Accept Lead</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No available leads match your filter criteria.</p>
    {% endif %}
</div>
{% endblock %}